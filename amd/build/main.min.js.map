{"version":3,"file":"main.min.js","sources":["../src/main.js"],"sourcesContent":["import $ from 'jquery';\nimport ModalForm from 'core_form/modalform';\nimport {getString} from 'core/str';\nimport Templates from 'core/templates';\nimport Notification from 'core/notification';\nimport ModalDeleteCancel from 'core/modal_delete_cancel';\nimport Repository from 'block_class_material/repository'\nimport ModalEvents from 'core/modal_events';\n\n\nconst addItem = root => {\n    const triggerElement = root.find('#add_material');\n    triggerElement.off();\n    triggerElement.on('click', event => {\n        event.preventDefault();\n\n        const modalForm = new ModalForm({\n            modalConfig: {\n                title: getString('form_title', 'block_class_material'),\n            },\n            formClass: 'block_class_material\\\\form\\\\add_material',\n            saveButtonText: getString('save', 'block_class_material'),\n            returnFocus: triggerElement,\n        });\n\n        modalForm.addEventListener(modalForm.events.SUBMIT_BUTTON_PRESSED, event => {\n            event.preventDefault();\n            $('input[name=\"cmid\"]').val(Number(root.data('course-module-id')));\n\n            if(modalForm.validateElements()) {\n                modalForm.submitFormAjax();\n            }\n        });\n\n        modalForm.show();\n\n        modalForm.addEventListener(modalForm.events.FORM_SUBMITTED, async event => {\n            await drawItem(root, event.detail);\n            Notification.addNotification({\n                message: await getString('upload_success', 'block_class_material'),\n                type: 'success',\n                closebutton: true,\n                annouce: true,\n            });\n        });\n    });\n};\n\nconst drawItem = async (root, data) => {\n    if(root.data('canedit')) {\n        data.canEdit = true;\n    }\n    const fileItemTemplate = await Templates.render('block_class_material/file-item', data);\n    root.find('.document-container').append(fileItemTemplate);\n    loadActions(root);\n};\n\nconst loadActions = root => {\n    const deleteButtons = root.find('.document-item-actions-button-delete');\n\n    deleteButtons.off();\n    deleteButtons.on('click', async event => {\n        event.preventDefault();\n        const target = $(event.currentTarget);\n        const modal = await ModalDeleteCancel.create({\n            title: getString('modal_delete_document_title', 'block_class_material'),\n            body: getString('modal_delete_document_body', 'block_class_material'),\n            isVerticallyCentered: true,\n        });\n        modal.getRoot().off();\n        modal.getRoot().on(\n            ModalEvents.delete,\n            async () => {\n                Repository.deleteFile({\n                    fileid: Number(target.data('delete-item'))\n                }).then(async response => {\n                    if(response.deleted) {\n                        root.find(`[data-item-id=\"${target.data('delete-item')}\"]`).remove();\n                        Notification.addNotification({\n                            message: await getString('delete_success', 'block_class_material'),\n                            type: 'success',\n                            closebutton: true,\n                            annouce: true,\n                        });\n                        return;\n                    }\n\n                    Notification.addNotification({\n                        message: await getString('delete_error', 'block_class_material'),\n                        type: 'error',\n                        closebutton: true,\n                        annouce: true,\n                    });\n                });\n            }\n        );\n        modal.show();\n    });\n};\n\nexport const init = async (root) => {\n    addItem(root);\n    loadActions(root);\n};"],"names":["drawItem","async","root","data","canEdit","fileItemTemplate","Templates","render","find","append","loadActions","deleteButtons","off","on","event","preventDefault","target","currentTarget","modal","ModalDeleteCancel","create","title","body","isVerticallyCentered","getRoot","ModalEvents","delete","deleteFile","fileid","Number","then","response","deleted","remove","addNotification","message","type","closebutton","annouce","show","triggerElement","modalForm","ModalForm","modalConfig","formClass","saveButtonText","returnFocus","addEventListener","events","SUBMIT_BUTTON_PRESSED","val","validateElements","submitFormAjax","FORM_SUBMITTED","detail","addItem"],"mappings":"s0BAgDMA,SAAWC,MAAOC,KAAMC,QACvBD,KAAKC,KAAK,aACTA,KAAKC,SAAU,SAEbC,uBAAyBC,mBAAUC,OAAO,iCAAkCJ,MAClFD,KAAKM,KAAK,uBAAuBC,OAAOJ,kBACxCK,YAAYR,OAGVQ,YAAcR,aACVS,cAAgBT,KAAKM,KAAK,wCAEhCG,cAAcC,MACdD,cAAcE,GAAG,SAASZ,MAAAA,QACtBa,MAAMC,uBACAC,QAAS,mBAAEF,MAAMG,eACjBC,YAAcC,6BAAkBC,OAAO,CACzCC,OAAO,kBAAU,8BAA+B,wBAChDC,MAAM,kBAAU,6BAA8B,wBAC9CC,sBAAsB,IAE1BL,MAAMM,UAAUZ,MAChBM,MAAMM,UAAUX,GACZY,sBAAYC,QACZzB,8BACe0B,WAAW,CAClBC,OAAQC,OAAOb,OAAOb,KAAK,kBAC5B2B,MAAK7B,MAAAA,cACD8B,SAASC,eACR9B,KAAKM,8BAAuBQ,OAAOb,KAAK,sBAAoB8B,oCAC/CC,gBAAgB,CACzBC,cAAe,kBAAU,iBAAkB,wBAC3CC,KAAM,UACNC,aAAa,EACbC,SAAS,0BAKJJ,gBAAgB,CACzBC,cAAe,kBAAU,eAAgB,wBACzCC,KAAM,QACNC,aAAa,EACbC,SAAS,UAKzBpB,MAAMqB,yBAIMtC,MAAAA,OA1FJC,CAAAA,aACNsC,eAAiBtC,KAAKM,KAAK,iBACjCgC,eAAe5B,MACf4B,eAAe3B,GAAG,SAASC,QACvBA,MAAMC,uBAEA0B,UAAY,IAAIC,mBAAU,CAC5BC,YAAa,CACTtB,OAAO,kBAAU,aAAc,yBAEnCuB,UAAW,2CACXC,gBAAgB,kBAAU,OAAQ,wBAClCC,YAAaN,iBAGjBC,UAAUM,iBAAiBN,UAAUO,OAAOC,uBAAuBnC,QAC/DA,MAAMC,qCACJ,sBAAsBmC,IAAIrB,OAAO3B,KAAKC,KAAK,sBAE1CsC,UAAUU,oBACTV,UAAUW,oBAIlBX,UAAUF,OAEVE,UAAUM,iBAAiBN,UAAUO,OAAOK,gBAAgBpD,MAAAA,cAClDD,SAASE,KAAMY,MAAMwC,8BACdpB,gBAAgB,CACzBC,cAAe,kBAAU,iBAAkB,wBAC3CC,KAAM,UACNC,aAAa,EACbC,SAAS,WA2DrBiB,CAAQrD,MACRQ,YAAYR"}