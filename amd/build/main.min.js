define("block_class_material/main",["exports","jquery","core_form/modalform","core/str","core/templates","core/notification","block_class_material/repository","core/modal_events","core/modal_factory"],(function(_exports,_jquery,_modalform,_str,_templates,_notification,_repository,_modal_events,_modal_factory){function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}Object.defineProperty(_exports,"__esModule",{value:!0}),_exports.init=void 0,_jquery=_interopRequireDefault(_jquery),_modalform=_interopRequireDefault(_modalform),_templates=_interopRequireDefault(_templates),_notification=_interopRequireDefault(_notification),_repository=_interopRequireDefault(_repository),_modal_events=_interopRequireDefault(_modal_events),_modal_factory=_interopRequireDefault(_modal_factory);const drawItem=async(root,data)=>{root.data("canedit")&&(data.canEdit=!0);const fileItemTemplate=await _templates.default.render("block_class_material/file-item",data);root.find(".document-container").append(fileItemTemplate),loadActions(root)},loadActions=root=>{const deleteButtons=root.find(".document-item-actions-button-delete");deleteButtons.off(),deleteButtons.on("click",(async event=>{event.preventDefault();const target=(0,_jquery.default)(event.currentTarget),modal=await _modal_factory.default.create({type:_modal_factory.default.types.DELETE_CANCEL,title:await(0,_str.get_string)("modal_delete_document_title","block_class_material"),body:await(0,_str.get_string)("modal_delete_document_body","block_class_material")});modal.getRoot().off(),modal.getRoot().on(_modal_events.default.delete,(async()=>{_repository.default.deleteFile({fileid:Number(target.data("delete-item"))}).then((async response=>{if(response.deleted)return root.find('[data-item-id="'.concat(target.data("delete-item"),'"]')).remove(),void _notification.default.addNotification({message:await(0,_str.get_string)("delete_success","block_class_material"),type:"success",closebutton:!0,annouce:!0});_notification.default.addNotification({message:await(0,_str.get_string)("delete_error","block_class_material"),type:"error",closebutton:!0,annouce:!0})}))})),modal.show()}))};_exports.init=async root=>{(root=>{const triggerElement=root.find("#add_material");triggerElement.off(),triggerElement.on("click",(async event=>{event.preventDefault();const modalForm=new _modalform.default({modalConfig:{title:await(0,_str.get_string)("form_title","block_class_material")},formClass:"block_class_material\\form\\add_material",saveButtonText:await(0,_str.get_string)("save","block_class_material"),returnFocus:triggerElement});modalForm.addEventListener(modalForm.events.SUBMIT_BUTTON_PRESSED,(event=>{event.preventDefault(),(0,_jquery.default)('input[name="cmid"]').val(Number(root.data("course-module-id"))),modalForm.validateElements()&&modalForm.submitFormAjax()})),modalForm.show(),modalForm.addEventListener(modalForm.events.FORM_SUBMITTED,(async event=>{await drawItem(root,event.detail),_notification.default.addNotification({message:await(0,_str.get_string)("upload_success","block_class_material"),type:"success",closebutton:!0,annouce:!0})}))}))})(root),loadActions(root)}}));

//# sourceMappingURL=main.min.js.map